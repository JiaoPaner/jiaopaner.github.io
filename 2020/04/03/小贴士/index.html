<!DOCTYPE html>
<html lang="zh-Hansn">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.png">
  <link rel="icon" type="image/png" href="/img/avatar.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="description" content="">
  <meta name="author" content="JiaoPan">
  <meta name="keywords" content="deep learning|computer vision">
  <title>小贴士 ~ 今天的风儿甚是喧嚣 JiaoPan</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"  >
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css"  >
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css"  >
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css"  >

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"  >

<link rel="stylesheet" href="/css/main.css"  >


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"  >


<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>今天的风儿甚是喧嚣 JiaoPan</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">主页</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">分类</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background"
         style="background: url('/img/default.png')no-repeat center center;
           background-size: cover;
           background-attachment: fixed;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  Friday, April 3rd 2020, 2:06 pm
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    6.7k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      37 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <h1 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h1><p><strong>Q： Visual Studio 编译工程报错:error C4996: ‘strtok’: This function or variable may be unsafe. Consider using strtok_s instead</strong></p>
<p>工程属性 —&gt;C/C++ —&gt; 预处理器 —&gt; 预处理器定义,添加宏定义</p>
<pre><code class="lang-cpp">_CRT_SECURE_NO_WARNINGS
</code></pre>
<hr>
<p><strong>Q： pthread.h中报错：C2011“timespec”:“struct”类型重定义</strong></p>
<p>tim.h已定义，pthread.h添加如下代码：</p>
<pre><code class="lang-cpp">#if !defined( PTHREAD_H )
#define PTHREAD_H
#define HAVE_STRUCT_TIMESPEC
</code></pre>
<p><strong>Q：Visual Studio 工程编译dll,接口的定义</strong></p>
<p>A：接口的头文件应如下声明：</p>
<pre><code class="lang-cpp">#define LIB_API __declspec(dllexport) //导出函数
extern &quot;C&quot; {
    LIB_API char*   say();
}
</code></pre>
<p><strong>Q：C++调用DLL</strong></p>
<p>dll的创建</p>
<pre><code class="lang-cpp">//test.h
#ifdef __cplusplus
extern &quot;C&quot; {
#endif
__declspec(dllexport) int add(int a,int b);
#ifdef __cplusplus
}
#endif  // __cplusplus
</code></pre>
<pre><code class="lang-cpp">//test.cpp
#include &quot;test.h&quot;
int add(int a,int b) {
return a + b;
}
</code></pre>
<p>编译上述工程为dll，即生成test.dll，并复制到调用该dll工程的编译目录</p>
<p>dll的使用</p>
<pre><code class="lang-cpp">#include&lt;Windows.h&gt;
#includ&lt;iostream&gt;
typedef int (*padd)(int,int);
int main(int argc, char *argv[]){
    HMODULE test = LoadLibrary(&quot;test.dll&quot;);
    if (test != NULL){
        padd add = (padd)GetProcAddress(test,&quot;add&quot;);
        if (add != NULL){    
            std::cout &lt;&lt; add(1,0) &lt;&lt; std::endl;
        }
    }
}
</code></pre>
<p><strong>Q:cmake 简单编译命令</strong></p>
<pre><code class="lang-bash">sudo tar -zxvf test
cd test
sudo mkdir build
cd build/

sudo cmake -DCMAKE_INSTALL_PREFIX=/home/test .. #安装目录
sudo make -j4 #编译
sudo make install #安装
sudo ldconfig #更新软连接
</code></pre>
<p><strong>Q: mac安装LLVM</strong></p>
<pre><code class="lang-bash">$ cd where-you-want-llvm-to-live
$ svn co http://llvm.org/svn/llvm-project/llvm/trunk llvm

$ cd llvm/tools
$ svn co http://llvm.org/svn/llvm-project/cfe/trunk clang

$ cd llvm/tools/clang/tools
$ svn co http://llvm.org/svn/llvm-project/clang-tools-extra/trunk extra

$ cd llvm/projects
$ svn co http://llvm.org/svn/llvm-project/compiler-rt/trunk compiler-rt

$ cd llvm
$ mkdir build
$ cd build
$ cmake -G &quot;Unix Makefiles&quot; ..
$ make
$ make install
</code></pre>
<p><strong>Q:cJSON的使用</strong></p>
<pre><code class="lang-cpp">#include &quot;cJSON.h&quot;
cJSON  *root = cJSON_CreateObject();
cJSON  *bboxs = cJSON_CreateArray();
char *resultJson;

cJSON_AddNumberToObject(root, &quot;status&quot;, 1);
cJSON_AddStringToObject(root, &quot;msg&quot;, &quot;detect ok&quot;);
cJSON_AddItemToObject(root, &quot;bboxs&quot;, bboxs);

for (int i = 0; i &lt; 2; i++){
  cJSON  *bbox;
  cJSON_AddItemToArray(bboxs, bbox = cJSON_CreateObject());
  cJSON_AddNumberToObject(bbox, &quot;score&quot;, 99);
  cJSON_AddNumberToObject(bbox, &quot;x&quot;, 1);
  cJSON_AddNumberToObject(bbox, &quot;y&quot;, 2);
  cJSON_AddNumberToObject(bbox, &quot;width&quot;, 3);
  cJSON_AddNumberToObject(bbox, &quot;height&quot;, 4);
}
resultJson = cJSON_PrintUnformatted(result);
</code></pre>
<p><strong>Q:c#调用dll</strong></p>
<p>note:若dll为X64,则c#应编译x64,否则报错</p>
<pre><code class="lang-c#">using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading.Tasks;

namespace test
{
    class Program
    {
        [DllImport(@&quot;facedetection.dll&quot;, EntryPoint = &quot;facedetect&quot;)]
        extern static string facedetect(string src);
        static void Main(string[] args)
        {
            string result = facedetect(&quot;test.jpg&quot;);
            Console.WriteLine(result);
            Console.ReadKey();
        }
    } 
}
</code></pre>
<p><strong>Q: c++时间差计算</strong></p>
<pre><code class="lang-cpp">#include &lt;chrono&gt;
auto start = std::chrono::steady_clock::now();
//do something
auto end = std::chrono::steady_clock::now();
std::chrono::duration&lt;double&gt; elapsed = end - start;
std::cout &lt;&lt; &quot;elapsed:&quot; &lt;&lt; elapsed.count() &lt;&lt;&quot;s&quot;&lt;&lt; std::endl;
</code></pre>
<p><strong>Q: c++读写文件</strong></p>
<pre><code class="lang-cpp">#include &lt;fstream&gt;
#include &lt;iomanip&gt;
//写文件
ofstream out_txt_file;
out_txt_file.open(&quot;image.bat&quot;, ios::out | ios::trunc);
for (int i = 0; i &lt; image.size(); i++) {
    out_txt_file &lt;&lt; to_string(image[i]) &lt;&lt; endl;
}
out_txt_file.close();
//读文件
std::vector&lt;float&gt; image;
ifstream infile;
infile.open(&quot;image.bat&quot;);
assert(infile.is_open());
string s;
while(getline(infile,s)){
    image.push_back(stof(s));
}
infile.close();

std::pair&lt;char*, int&gt; readFile(std::string path) {
  fstream in(path, ios::in | ios::binary);
  if (!in.is_open()) {
    cerr &lt;&lt; &quot;file not find&quot; &lt;&lt; endl;
  }
  in.seekg(0, ios::end);
  long size;
  size = in.tellg();
  char* buf = new char[size];
  in.seekg(ios::beg);
  in.read(buf, size);

  return std::make_pair(buf, size);
}
</code></pre>
<p><strong>Q: mmap</strong></p>
<pre><code class="lang-cpp">void *mmap(void *start, size_t length, int prot, int flags, int fd, off_t offset);
</code></pre>
<ul>
<li>start：指定映射的内存地址,设置为 NULL -&gt;操作系统自动选择合适的内存地址</li>
<li>length：映射地址空间的字节数,从被映射文件开头 offset 个字节开始统计</li>
<li>prot：指定共享内存的访问权限,PROT_READ(可读),PROT_WRITE(可写), PROT_EXEC(可执行), PROT_NONE(不可访问)</li>
<li>flags：MAP_SHARED(共享的), MAP_PRIVATE(私有)</li>
<li>fd：映射的文件句柄,fd = open(file_path, flag, mode);</li>
<li>offset：映射文件的偏移量,设置0 -&gt;从文件头部开始映射</li>
</ul>
<pre><code class="lang-cpp">int32_t fd = open(filePath.c_str(), O_RDONLY, 0);
if(fd &lt; 0){
    return nullptr;
}
char* pBuffer = (char)mmap(nullptr, (size_t)fileSize, PROT_READ, MAP_FILE | MAP_SHARED, fd, 0);
</code></pre>
<p><strong>Q:cmake添加编译选项</strong></p>
<pre><code>SET(CMAKE_C_FLAGS_DEBUG &quot;-g -D_DEBUG -O0&quot;)  
SET(CMAKE_C_FLAGS_RELEASE &quot;-g -DNDEBUG -O3&quot;)

SET(CMAKE_CXX_FLAGS_DEBUG &quot;-g -D_DEBUG -O0&quot;)  
SET(CMAKE_CXX_FLAGS_RELEASE &quot;-g -DNDEBUG -O3&quot;)
</code></pre><h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><p><strong>Q：python打包发布</strong></p>
<p>1.项目根目录新建setup.py</p>
<pre><code class="lang-python">from distutils.core import setup
setup(
 name=&#39;test&#39;,  #打包的输出文件名
 version=&#39;1.0.0&#39;,
 py_modules=[&#39;test&#39;] #打包的.py文件
)
</code></pre>
<p>依赖文件 requirements.txt生成</p>
<p>pip freeze &gt; requirements.txt</p>
<pre><code class="lang-text">opencv==3.4.2
numpy==1.16.4
scikit-image==0.15.0
</code></pre>
<p>或者 conda list -e &gt; requirements.txt</p>
<pre><code class="lang-text">numpy=1.16.4
opencv=3.4.2
scikit-image=0.15.0
</code></pre>
<p>2.项目根目录下执行命令</p>
<pre><code class="lang-bash">sudo python setup.py sdist
</code></pre>
<p>生成dist目录且包含test-1.0.0.tar.gz分发包</p>
<p>3.安装：解压分发包并定位到解压目录后执行安装命令</p>
<pre><code class="lang-bash">pip install -r requirements.txt #安装依赖 或者 conda install --yes --file requirements.txt
sudo python setup.py install
</code></pre>
<p>4.使用</p>
<pre><code class="lang-python">import test
test.sayHello();//#调用模块的sayHello方法
</code></pre>
<p><strong>Q:jupyter notebook 运行于指定的conda环境上</strong></p>
<pre><code class="lang-bash">$ conda install nb_conda #重启jupyter notebook 选择kernel即可
</code></pre>
<pre><code class="lang-bash">$ conda info --envs
# conda environments:
#
base                     /Volumes/storage/mac/miniconda3
python36              *  /Volumes/storage/mac/miniconda3/envs/python36
$ jupyter kernelspec list
Available kernels:
  reco_base    /Users/jiaopan/Library/Jupyter/kernels/reco_base
  python3      /Volumes/storage/mac/miniconda3/envs/python36/share/jupyter/kernels/python3
$ cd /Volumes/storage/mac/miniconda3/envs/python36
$ vi kernel.json
{
 &quot;argv&quot;: [
  &quot;/Volumes/storage/mac/miniconda3/envs/python36/bin/python&quot;,#修改
  &quot;-m&quot;,
  &quot;ipykernel_launcher&quot;,
  &quot;-f&quot;,
  &quot;{connection_file}&quot;
 ],
 &quot;display_name&quot;: &quot;Python 3&quot;,
 &quot;language&quot;: &quot;python&quot;
}
</code></pre>
<p><strong>Q:设置jupyter notebook可远程访问</strong></p>
<pre><code class="lang-bash">$ jupyter notebook --generate-config
Writing default config to: /home/adminpc/.jupyter/jupyter_notebook_config.py

$ jupyter notebook password
Enter password: 
Verify password: 
[NotebookPasswordApp] Wrote hashed password to /home/adminpc/.jupyter/jupyter_notebook_config.json

$ vim /home/adminpc/.jupyter/jupyter_notebook_config.py
c.NotebookApp.ip=&#39;*&#39;
# 密钥位于adminpc/.jupyter/jupyter_notebook_config.json
c.NotebookApp.password = &#39;sha1:0f0fe326cb63:0e48570b0b0952dfe72fefb7bd012934968ea428&#39;
c.NotebookApp.open_browser = False
c.NotebookApp.port =8888 

$ jupyter notebook 
[I 14:14:05.933 NotebookApp] Serving notebooks from local directory: /home/adminpc/jiaopan/projects
[I 14:14:05.933 NotebookApp] The Jupyter Notebook is running at:
[I 14:14:05.933 NotebookApp] http://admin-pc:8888/
[I 14:14:05.933 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).
</code></pre>
<p><strong>时间格式转换</strong></p>
<pre><code class="lang-python">print(datetime.strftime(datetime.now(),&quot;%Y-%m-%d %H:%M:%S&quot;))
print(datetime.strptime(&quot;2021-03-15 02:26:07&quot;,&quot;%Y-%m-%d %H:%M:%S&quot;))

#时间戳转换
timeArray = time.localtime(int(time.time()))
otherStyleTime = time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, timeArray)
print(otherStyleTime)
</code></pre>
<p><strong>Q:调用c++库文件</strong></p>
<pre><code class="lang-python">so = ctypes.cdll.LoadLibrary(&quot;/home/jiaopan/projects/c++/detector-onnx-linux/cmake-build-debug/libdetector.so&quot;)
model_path = bytes(&quot;/home/jiaopan/projects/c++/detector-onnx-linux/model/yolov5s.onnx&quot;, &quot;utf-8&quot;)
status = so.init(model_path, 1)
print(status)
image = bytes(&quot;/home/jiaopan/Downloads/bus.jpg&quot;, &quot;utf-8&quot;)
detectFile = so.detectByFile
detectFile.restype = ctypes.c_char_p
result = detectFile(image, ctypes.c_float(0.5))
result = ctypes.string_at(result, -1).decode(&quot;utf-8&quot;)
print(result)
</code></pre>
<p><strong>Q:pytorch2paddle</strong></p>
<pre><code class="lang-python"># -*- coding: utf-8 -*-
# @Time    : 2022/3/8 14:38
# @Author  : jiaopaner
import sys
sys.path.insert(0, &#39;./&#39;)
import torch
import numpy as np
from torchvision.models import AlexNet
from torch.utils.model_zoo import load_url as load_state_dict_from_url
from collections import OrderedDict
from craft import CRAFT

def copyStateDict(state_dict):
    if list(state_dict.keys())[0].startswith(&quot;module&quot;):
        start_idx = 1
    else:
        start_idx = 0
    new_state_dict = OrderedDict()
    for k, v in state_dict.items():
        name = &quot;.&quot;.join(k.split(&quot;.&quot;)[start_idx:])
        new_state_dict[name] = v
    return new_state_dict

if __name__ == &#39;__main__&#39;:
    # 构建输入
    input_data = np.random.rand(1, 3, 960, 960).astype(&quot;float32&quot;)
    # 获取PyTorch Module
    # torch_module = AlexNet()
    # torch_state_dict = load_state_dict_from_url(&#39;https://download.pytorch.org/models/alexnet-owt-4df8aa71.pth&#39;)
    # torch_module.load_state_dict(torch_state_dict)
    # # 设置为eval模式
    # torch_module.eval()
    net = CRAFT()
    net.load_state_dict(copyStateDict(torch.load(&quot;/Volumes/storage/resources/models/paddle-ocr-models/craft_mlt_25k.pth&quot;, map_location=&quot;cpu&quot;)))
    net.eval()
    # 进行转换
    # from x2paddle.convert import pytorch2paddle
    #
    # pytorch2paddle(net,
    #                save_dir=&quot;pd_model_trace&quot;,
    #                jit_type=&quot;trace&quot;,
    #                input_examples=[torch.tensor(input_data)])

    #dynamic shape
    x = torch.randn((1, 3, 960, 960))

    torch.onnx.export(net, x, &#39;./pd_model/model.onnx&#39;, opset_version=11, input_names=[&quot;input&quot;],
                      output_names=[&quot;output&quot;], dynamic_axes={&#39;input&#39;: [2,3]})
</code></pre>
<pre><code class="lang-bash">x2paddle --framework=onnx --model=./pd_model/model.onnx --save_dir=pd_model_dynamic
</code></pre>
<pre><code class="lang-python">####x2paddle_code.py####
if __name__ == &#39;__main__&#39;:
    x = paddle.randn((1,3,100,100),dtype=paddle.float32)
    result = main(x)
    print(result)
</code></pre>
<h1 id="opencv"><a href="#opencv" class="headerlink" title="opencv"></a>opencv</h1><p><strong>Q:cv::Mat替换值</strong></p>
<pre><code class="lang-cpp">dst = src.clone();
cv::Mat Roi(dst, cv::Rect(x, y, width, height));
cv::RNG rnger(cv::getTickCount());
rnger.fill(Roi, cv::RNG::UNIFORM, cv::Scalar::all(0), cv::Scalar::all(256));

//创建图像
Mat img(Size(320,240), CV_8UC3);
//选择ROI
Mat roi(img, Rect(10, 10, 100, 100));
//将ROI的颜色填充为绿色,原始的img图像将会改变
roi = Scalar(0,255,0);

//setTo
cv::Mat image(8, 9, CV_8UC3);
image.setTo(255);  //将值全部设置成255
cv::Rect roi(1, 1, 4, 3);
image(roi).setTo(200);  //指定像素点区域的值都设置成200
image.at&lt;cv::Vec3b&gt;(0,0)[1] = 99;
image.setTo(88,image == 99);  //将M中等于99的值设置成88
//参数2是条件判断  可以是小于  大于等等

cv::Mat mask = cv::Mat::zeros(image.size(),CV_8UC3);
//建立与原图一样大小的mask图像，并将所有像素初始化为0
mask(roi).setTo(1);
mask.at&lt;cv::Vec3b&gt;(0,0)[1] = 66;
image.setTo(55, mask); //在矩阵M中，把矩阵mask中不为0的值全部变为55
</code></pre>
<p><strong>Q:convertTo</strong></p>
<pre><code class="lang-cpp">void cv::Mat::convertTo(OutputArray m, int rtype, double alpha = 1, double beta = 0) const
image.convertTo(dst,CV_8UC1);//类型转换 CV_32FC1-&gt;CV_8UC1
image.convertTo(dst, CV_8CU1, 1.0/255, 0.5);
/*
alpha,beta-&gt; image = (image-&gt;element * alpha)-&gt;element + beta
*/
</code></pre>
<p><strong>Q:connectedComponentsWithStats</strong></p>
<pre><code class="lang-cpp">//像素相同的区域连通函数
//image:单通道
//4连通:上下左右,8连通:上下左右+左上、右上、右下、左下
cv::Mat labels,stats,centroids;
int n_comps = cv::connectedComponentsWithStats(image,labels,stats,centroids,4); 
//n_comps:连通区域的数量。
//labels:labels.shape = image.shape,每一个连通区域会有一个唯一标识,标识从0索引,0为背景
//stats:包含5个参数(x,y,h,w,s),对应每一个连通区域外接矩形的起始坐标x,y;外接矩形的width,height;s为labels对应的连通区域的像素个数
//centroids : 返回的是连通区域的质心
</code></pre>
<p><strong>Q:cv2::threshold</strong></p>
<pre><code class="lang-cpp">cv::threshold (src,dst,thresh, maxval, type)
src:源矩阵,单通道
dst:目标
thresh:阈值,取值范围 0～255
maxval:填充色,取值范围 0～255
type：阈值类型

阈值    小于阈值的像素点    大于阈值的像素点
0            置0                置填充色
1          置填充色               置0
2          保持原色              置灰色
3            置0                保持原色
4          保持原色               置0
</code></pre>
<p><strong>Q:读取摄像头/视频流</strong></p>
<pre><code class="lang-python">cap = cv2.VideoCapture(&quot;/home/jiaopan/Downloads/jd2.mp4&quot;)
    index = 0;
    detect = so.detectByBase64
    detect.restype = ctypes.c_char_p
    if cap.isOpened():
        while True:
            ret, frame = cap.read()
            #frame = cv2.resize(frame, (320, 320), interpolation=cv2.INTER_AREA)
            if index % 1 == 0:
                start = datetime.now()
                #cv2.imwrite(&quot;frame.jpg&quot;,frame)
                #result = detectFile(bytes(&quot;frame.jpg&quot;,&quot;utf-8&quot;), ctypes.c_float(0.6))
                image = frame2base64(frame)
                result = detect(image, ctypes.c_float(0.4))
                end = datetime.now()
                print(&quot;time cost:&quot;,(end-start).total_seconds())
                result = ctypes.string_at(result, -1).decode(&quot;utf-8&quot;)
                result = json.loads(result)
                data = result[&quot;data&quot;]
                print(data)
                for box in data:
                    x = int(box[&quot;location&quot;][&quot;x&quot;])
                    y = int(box[&quot;location&quot;][&quot;y&quot;])
                    width = int(box[&quot;location&quot;][&quot;width&quot;])
                    height = int(box[&quot;location&quot;][&quot;height&quot;])
                    cv2.putText(frame, box[&quot;label&quot;], (x, y), cv2.FONT_HERSHEY_COMPLEX, 0.5, (0, 255, 255), 1)
                    cv2.rectangle(frame,(x,y),(x+width,y+height),(255,0,0),2)
            cv2.imshow(&#39;image&#39;, frame)
            k = cv2.waitKey(20)
            index += 1
            # q键退出
            if (k &amp; 0xff == ord(&#39;q&#39;)):
                break

    cap.release()
    cv2.destroyAllWindows()
</code></pre>
<p><strong>Q:图片转base64编码/base64编码还原图片</strong></p>
<pre><code class="lang-python">def image_to_base64(image):
    image = cv2.imencode(&#39;.jpg&#39;, image)[1]
    image_code = str(base64.b64encode(image))[2:-1]
    return image_code
image = cv2.imread(&quot;test-04-output-0001.jpg&quot;)
print(image_to_base64(image))

def base64_to_image(base64_code):
    # base64解码
    img_data = base64.b64decode(base64_code)
    # 转换为np数组
    img_array = np.fromstring(img_data, np.uint8)
    # 转换成opencv可用格式
    img = cv2.imdecode(img_array, cv2.COLOR_RGB2BGR)
    return img
</code></pre>
<p><strong>Q：opencv Mat和byte互转</strong></p>
<pre><code class="lang-cpp">unsigned char* matToBytes(Mat image){
   int size = image.total() * image.elemSize();
     unsigned char* bytes = new unsigned char[size];  // you will have to delete[] that later
     std::memcpy(bytes, image.data, size * sizeof(unsigned char));
     return bytes;
}
Mat bytesToMat(unsigned char* bytes,int width,int height){
    Mat image = Mat(height,width,CV_8UC3,bytes).clone(); // make a copy
    return image;
}
</code></pre>
<p><strong>Q:opencv Mat 转std::vector std::vector转std::string</strong></p>
<pre><code class="lang-cpp">cv::Mat output = output.reshape(1, 1);
std::vector&lt;double&gt; vetor = (std::vector&lt;double&gt;)output;
std::stringstream ss;
ss &lt;&lt; std::setprecision(16);//精度设置
std::copy(vector.begin(), vector.end(), std::ostream_iterator&lt;double&gt;(ss, &quot;,&quot;));
std::string values = ss.str();
values.pop_back();//去掉末尾多余的分隔符
std::cout &lt;&lt; values;

Mat convertToMat(std::string str) {
    std::vector&lt;double&gt; v;
    std::stringstream ss(str);
    ss &lt;&lt; std::setprecision(16);
    std::string token;
    while (std::getline(ss, token, &#39;,&#39;)) {
        v.push_back(std::stod(token));
    }
    Mat output = cv::Mat(v, true).reshape(1, 1);
    return output;
}

cv::FileStorage fs(&quot;../features.xml&quot;, cv::FileStorage::WRITE);
fs &lt;&lt; &quot;features&quot; &lt;&lt; output;
fs.release();
</code></pre>
<p><strong>Q: opencv 截取图片的矩形区域</strong></p>
<pre><code class="lang-cpp">cv::rectangle(image, Rect(x, y, w, h), Scalar(0, 255, 0), 2);
Mat dst = image(cv::Range(y,y+h),cv::Range(x,x+w));
</code></pre>
<p><strong>Q: Mat直接赋值</strong></p>
<pre><code class="lang-cpp">double left = 0,right = 0.5,top = 0,bottom = 0.5;
cv::Mat pbox = (cv::Mat_&lt;double&gt;(4,2)&lt;&lt;left,top,right,top,right,bottom,left,bottom); 

cv::Mat data_map(height, width, CV_8UC1, (unsigned char *)vec.data());
cv::Mat data_map(height, width, CV_32FC1, (float *)vec.data());
</code></pre>
<p><strong>Q: Mat 行列 SUM/MAX/MIN/AVG</strong></p>
<pre><code class="lang-cppc">cv::reduce(pbox,sum_value,1,cv::REDUCE_SUM);
</code></pre>
<h1 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h1><p><strong>Q：springboot切面编程实例</strong></p>
<pre><code class="lang-java">@Aspect
@Component
@Slf4j
public class WebLogAspect {
    //定义一个切入点，对该包下的所有函数方法执行前，执行@Before()
    @Pointcut(&quot;execution(public * com.jp.controller..*.*(..))&quot;)
    public void webLog(){}

    @Before(&quot;webLog()&quot;)
    public void doBefore(JoinPoint joinPoint) throws Throwable {
        // 接收到请求，记录请求内容
        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        HttpServletRequest request = attributes.getRequest();

        // 记录下请求内容
        log.info(&quot;URL : &quot; + request.getRequestURL().toString());
        log.info(&quot;HTTP_METHOD : &quot; + request.getMethod());
        log.info(&quot;IP : &quot; + request.getRemoteAddr());
        log.info(&quot;CLASS_METHOD : &quot; + joinPoint.getSignature().getDeclaringTypeName() + &quot;.&quot; + joinPoint.getSignature().getName());
        log.info(&quot;ARGS : &quot; + Arrays.toString(joinPoint.getArgs()));

    }

    @AfterReturning(returning = &quot;ret&quot;, pointcut = &quot;webLog()&quot;)
    public void doAfterReturning(Object ret) throws Throwable {
        // 处理完请求，返回内容
        log.info(&quot;RESPONSE : &quot; + ret);
    }

}
</code></pre>
<p><strong>Q：Mac，MavenReportException: Error while creating archive: Unable to find javadoc command: The environment variable JAVA_HOME is not correctly set</strong></p>
<p>在pom.xml文件中添加javadoc命令的位置</p>
<pre><code>&lt;properties&gt;
     &lt;javadocExecutable&gt;/Library/Java/JavaVirtualMachines/jdk1.8.0_151.jdk/Contents/Home/bin/javadoc&lt;/javadocExecutable&gt;
&lt;/properties&gt;
</code></pre><p><strong>Q：maven引入本地依赖</strong></p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.oracle&lt;/groupId&gt;
    &lt;artifactId&gt;ojdbc6&lt;/artifactId&gt;
    &lt;scope&gt;system&lt;/scope&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;systemPath&gt;${basedir}/lib/ojdbc6-11.2.0.1.0.jar&lt;/systemPath&gt;
&lt;/dependency&gt;

&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;configuration&gt;
                &lt;includeSystemScope&gt;true&lt;/includeSystemScope&gt;
                &lt;mainClass&gt;mainclass&lt;/mainClass&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
</code></pre><p><strong>Q：普通maven项目打包配置</strong></p>
<pre><code class="lang-java">&lt;build&gt;  
 &lt;plugins&gt;  
  &lt;plugin&gt;
     &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
     &lt;version&gt;2.3.2&lt;/version&gt;
     &lt;configuration&gt;
         &lt;source&gt;1.8&lt;/source&gt;
         &lt;target&gt;1.8&lt;/target&gt;
     &lt;/configuration&gt;
  &lt;/plugin&gt;
  &lt;plugin&gt;
        &lt;artifactId&gt; maven-assembly-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
             &lt;descriptorRefs&gt;
             &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;
             &lt;/descriptorRefs&gt;
             &lt;archive&gt;
                  &lt;manifest&gt;
                       &lt;mainClass&gt;jiaopaner.spark.learning.App&lt;/mainClass&gt;
                  &lt;/manifest&gt;
             &lt;/archive&gt;
        &lt;/configuration&gt;
        &lt;executions&gt;
             &lt;execution&gt;
                  &lt;id&gt;make-assembly&lt;/id&gt;
                  &lt;phase&gt;package&lt;/phase&gt;
                  &lt;goals&gt;
                       &lt;goal&gt;single&lt;/goal&gt;
                  &lt;/goals&gt;
             &lt;/execution&gt;
        &lt;/executions&gt;
   &lt;/plugin&gt;
 &lt;/plugins&gt;  
&lt;/build&gt;
</code></pre>
<p><strong>Q:springboot-kafka集群</strong></p>
<pre><code class="lang-bash"># 显示启动
./bin/kafka-server-start.sh ./config/server.properties

# 在后台启动
./bin/kafka-server-start.sh -daemon ./config/server.properties

#创建topic
# --create：表示创建
# --zookeeper 后面的参数是zk的集群节点
# --replication-factor 3 ：表示复本数
# --partitions 3：表示分区数
# --topic test：表示topic的主题名称

./bin/kafka-topics.sh --create --zookeeper server01:2181,server02:2181,server03:2181 --replication-factor 3 --partitions 3 --topic test

#查看topic
./bin/kafka-topics.sh --list --zookeeper server01:2181
#删除topic
./bin/kafka-topics.sh --delete --zookeeper server01:2181 --topic test

#生产者命令
/bin/kafka-console-producer.sh --broker-list server01:9092 --topic test

#消费者命令
/bin/kafka-console-consumer.sh --zookeeper server01:2181 --from-beginning --topic test
</code></pre>
<p><strong>Q:maven dependency scope设置</strong></p>
<ul>
<li>provided:编译和测试阶段依赖</li>
</ul>
<pre><code class="lang-bash">&lt;dependency&gt;
    &lt;groupId&gt;org.jiaoper/groupId&gt;
    &lt;artifactId&gt;utils-common&lt;/artifactId&gt;
    &lt;version&gt;3.0-alpha-1&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
<ul>
<li>test:测试阶段依赖</li>
</ul>
<pre><code class="lang-bash">&lt;dependency&gt;
    &lt;groupId&gt;org.jiaoper/groupId&gt;
    &lt;artifactId&gt;utils-common&lt;/artifactId&gt;
    &lt;version&gt;3.0-alpha-1&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
<ul>
<li>compile:编译、测试和运行阶段依赖(默认)</li>
</ul>
<pre><code class="lang-bash">&lt;dependency&gt;
    &lt;groupId&gt;org.jiaoper/groupId&gt;
    &lt;artifactId&gt;utils-common&lt;/artifactId&gt;
    &lt;version&gt;3.0-alpha-1&lt;/version&gt;
    &lt;scope&gt;complie&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
<h1 id="StackOverflow"><a href="#StackOverflow" class="headerlink" title="StackOverflow"></a>StackOverflow</h1><p><strong>Q：利用nginx共享文件夹</strong></p>
<p>nginx.conf添加如下配置</p>
<pre><code>server {
    listen       8000;
    server_name  localhost;
    charset utf-8;
    location / {
    root /home;#共享根目录下的home文件夹
    # 索引
    autoindex on;
    # 显示文件大小
    autoindex_exact_size on;
    # 显示文件时间
    autoindex_localtime on;
    #index  index.html index.htm;
  }
}
</code></pre><p><strong>Q:更改ubuntu源为阿里云源</strong></p>
<pre><code class="lang-bash">sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak

sudo vim /etc/apt/source.list

deb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-properties
deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted
deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-properties
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-properties
deb http://mirrors.aliyun.com/ubuntu/ xenial universe
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe
deb http://mirrors.aliyun.com/ubuntu/ xenial multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse #Added by software-properties
deb http://archive.canonical.com/ubuntu xenial partner
deb-src http://archive.canonical.com/ubuntu xenial partner
deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe #Added by software-properties
deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe
deb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse

apt-get update 

#or
mv /etc/apt/sources.list /etc/apt/sources.list.bak
echo &quot;deb http://mirrors.163.com/debian/ jessie main non-free contrib&quot; &gt;&gt; /etc/apt/sources.list
echo &quot;deb http://mirrors.163.com/debian/ jessie-proposed-updates main non-free contrib&quot; &gt;&gt;/etc/apt/sources.list
echo &quot;deb-src http://mirrors.163.com/debian/ jessie main non-free contrib&quot; &gt;&gt;/etc/apt/sources.list
echo &quot;deb-src http://mirrors.163.com/debian/ jessie-proposed-updates main non-free contrib&quot; &gt;&gt;/etc/apt/sources.list

apt-get update
</code></pre>
<p><strong>Q:oracle导入dmp备份文件</strong></p>
<pre><code>[root@centos ～]# su - oracle
[oracle@centos ～]# sqlplus 
请输入用户名:  sys as sysdba
输入口令:
SQL&gt; CREATE USER 用户 IDENTIFIED BY 密码;
User created.

SQL&gt; GRANT CONNECT, RESOURCE, DBA TO 用户;
Grant succeeded.
SQL&gt; CONNECT 用户@orcl #新用户测试登陆
</code></pre><p>复制*.dmp文件到linux并加权</p>
<pre><code>[root@centos ～]# chmod 777 *.dmp
</code></pre><p>导入dmp数据库备份文件</p>
<pre><code>[root@centos ～] su - oracle
[oracle@centos ～]imp 用户名/密码@orcl file=/home/*.dmp ignore=y full=y;
 Import terminated successfully with warnings.(成功)
</code></pre><p><strong>Q：scp文件/目录上传/下载</strong></p>
<pre><code class="lang-java">#本地上传到远程
#文件
scp /root/test.json root@远程服务器ip:/usr/local/src
#目录
scp -r /home/testdir root@远程服务器ip:/home/testdir

#远程下载到本地
#文件
scp root@远程服务器ip:/usr/local/src/test.json /root/
#目录
scp -r root@远程服务器ip:/home/testdir /home/
</code></pre>
<p><strong>Q：Ubuntu增加swap交换空间</strong></p>
<pre><code class="lang-bash">$ free -m #查看分区大小
$ dd if=/dev/zero of=/swapfile bs=1M count=3k #创建count*bs大小的swap文件
$ mkswap /swapfile #创建swap空间
$ swapon /swapfile #设置分区有效 ,swapoff 设置分区无效
$ vim /etc/fstab #开启启动：添加/swapfile swap swap defaults 0 0
</code></pre>
<p><strong>Q：git创建分支</strong></p>
<pre><code class="lang-bash">git clone -b &lt;指定分支名&gt; &lt;远程仓库地址&gt; #克隆指定分支
git branch -a  #查看分支
git branch &lt;分支名&gt; #创建分支
git checkout &lt;分支名&gt; #切换到分支
git add . #提交
git commit -m &quot;&quot; 
git push origin &lt;分支名&gt;
</code></pre>
<p><strong>Q：git 子模块</strong></p>
<pre><code class="lang-bash">#添加
git submodule add &lt;url&gt; &lt;path&gt;
git submodule init
git submodule update
git submodule update --init --recursive

#删除
rm -rf 子模块源码目录
#删除子模块项
vi .gitmodules 
vi .git/config 
rm .git/module/子模块目录
git rm --cached 子模块名称
</code></pre>
<p><strong>Q：glibc升级</strong></p>
<pre><code class="lang-bash">#http://ftp.gnu.org/gnu/glibc/
wget http://ftp.gnu.org/gnu/glibc/glibc-2.23.tar.gz
tar -zxvf glibc-2.23.tar.gz
cd glibc-2.23
mkdir build
cd build
./configure --prefix=/usr --disable-profile --enable-add-ons --with-headers=/usr/include --with-binutils=/usr/bin
make &amp;&amp; make install 

&#39;&#39;&#39;
gawk: error while loading shared libraries: /lib64/libm.so.6: invalid ELF header
# 打开新终端执行如下命令
# cd /lib64
# unlink libm.so.6
# ln -s libm-2.23.so libm.so.6
# 回到原终端执行 make install
&#39;&#39;&#39;
</code></pre>
<p><strong>Q：libstdc++升级</strong></p>
<pre><code class="lang-bash">#下载最新版libstdc++
mv /usr/lib64/libstdc++.so.6  /usr/lib64/libstdc++.so.6.bak
ln -s /usr/lib64/libstdc++.so.6.0.26  /usr/lib64/libstdc++.so.6
</code></pre>
<pre><code>
**Q：linux免密登录**

```bash
$ ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/home/worker/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/worker/.ssh/id_rsa
Your public key has been saved in /home/worker/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:PmhwBGI0Gqgx8mCl5mHvj8ogyEfV9jnrzmLuKb2mOxQ worker@normalserver.inm.inner
The key&#39;s randomart image is:
+---[RSA 3072]----+
|o.*..            |
|*=.o ..          |
|=X   ..o         |
|= + .E. . .      |
| . o. o S+       |
|o o  + o  o      |
|+. o. + o.       |
|+ . o+ =+.       |
| o.. +X=++       |
+----[SHA256]-----+

#复制id_rsa.pub内容追加至目标连接主机.ssh/authorized_keys
$ ssh-copy-id -i ~/.ssh/id_rsa.pub worker@10.100.3.27
#手动方式
$ cd ~ 
$ mkdir .ssh &amp;&amp; chmod 700 .ssh
$ cd .ssh
$ touch id_rsa.pub # 复制ssh-keygen主机的id_rsa.pub内容置此
$ cat id_rsa.pub &gt;&gt; authorized_keys
$ chmod 600 authorized_keys
</code></pre><p><strong>Q：conda安装指定的cuda和cudnn</strong></p>
<pre><code class="lang-bash">conda install tensorflow-gpu=1.4.1 cudatoolkit=8.0 cudnn=6.0 -c https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/linux-64/
</code></pre>
<p><strong>Q：gcc版本</strong></p>
<pre><code class="lang-bash">#centos7
devtoolset-3对应gcc4.x.x版本
devtoolset-4对应gcc5.x.x版本
devtoolset-6对应gcc6.x.x版本
devtoolset-7对应gcc7.x.x版本
devtoolset-8对应gcc8.x.x版本
devtoolset-9对应gcc9.x.x版本
devtoolset-10对应gcc10.x.x版本

yum install centos-release-scl
yum install devtoolset-7
#激活
scl enable devtoolset-7 bash
#永久激活
scl enable devtoolset-7 bash
sudo vim /etc/profile
source /opt/rh/devtoolset-7/enable
#centos8
dnf install gcc-toolset-10
scl enable gcc-toolset-10 bash
</code></pre>
<p><strong>Q：sudo: /usr/lib/sudo/sudoers.so must be owned by uid 0</strong></p>
<pre><code class="lang-bash">#ubuntu -&gt; recovery mode  开机长按esc
$ pkexec chown root /usr/lib/sudo/sudoers.so
</code></pre>
<p><strong>Q：evpp 安装</strong></p>
<pre><code class="lang-bash">sudo yum -y install epel-release
sudo yum install glog-devel.x86_64
sudo yum install gflags-devel.x86_64
sudo yum install boost
sudo yum install boost-devel
#sudo yum remove libevent-devel #卸载旧版本
tar -zxvf libevent-2.1.12-stable.tar.gz
cd libevent-2.0.22-stable
./configure --prefix=/usr/local &amp;&amp; make &amp;&amp; sudo make install

#openssl
tar -zxvf openssl-1.1.1m.tar.gz:q:
cd openssl-1.1.1m
./config --prefix=/usr/local/openssl
sudo make
sudo make install

git clone https://github.com/Qihoo360/evpp
cd evpp  #编辑CMakeLists.txt 指定openssl
git submodule update --init --recursive

mkdir -p build &amp;&amp; cd build
cmake ..
make -j6
</code></pre>
<p><strong>Q：centos时钟修复</strong></p>
<pre><code class="lang-bash">yum install ntp -y
ntpdate ntp.aliyun.com
</code></pre>
<p><strong>Q：grub引导修复</strong></p>
<pre><code class="lang-bash">grub rescue&gt; ls
grub rescue&gt; ls (hd0,msdos1)/boot/grub

grub rescue&gt; set root=(hd0,msdos1)
grub rescue&gt; set prefix=(hd0,msdos1)/boot/grub

grub rescue&gt; insmod normal
grub rescue&gt; normal

$ sudo update-grub
$ sudo grub-install /dev/sda
</code></pre>
<p><strong>Q：RuntimeError: Failed to export an ONNX attribute ‘onnx::Gather’, since it’s not constant, please try to make things (e.g., kernel size) static if possible</strong></p>
<pre><code class="lang-python"># output size 改为常量值
nn.AdaptiveAvgPool2d((None, 1)) -&gt; nn.AdaptiveAvgPool2d((512, 1))
</code></pre>
<p><strong>Q：pytoch numpy 打印值显示完全</strong></p>
<pre><code class="lang-python">torch.set_printoptions(threshold=np.inf,sci_mode=False,suppress=True,profile=&quot;full&quot;)
np.set_printoptions(threshold=np.inf,suppress=True)
</code></pre>
<p><strong>Q：onnx convert to mnn</strong></p>
<pre><code># MNN_BUILD_OPENCV=ON,MNN_BUILD_CONVERTER=ON
./MNN/schema/generate.sh
#mac/linux
cmake .. &amp;&amp; make -j4 
#android
cd project/android
mkdir build_32 &amp;&amp; cd build_32 &amp;&amp; ../build_32.sh #armv7
mkdir build_64 &amp;&amp; cd build_64 &amp;&amp; ../build_64.sh #armv8

./MNNConvert -f ONNX --modelFile xx.onnx --MNNModel mnn_models/xx.mnn --bizCode biz --weightQuantBits 8

./MNNConvert -f TORCH --modelFile ./torchscript.pt --MNNModel mnn_models/test.mnn --bizCode biz
</code></pre><p><strong>Q：Timeout waiting to lock execution history cache</strong></p>
<pre><code class="lang-bash">find ~/.gradle -type f -name &quot;*.lock&quot; -delete
</code></pre>
<p><strong>Q：kenlm train</strong></p>
<ul>
<li>-o -&gt; order执行命令的选项；</li>
<li>3 -&gt; N元语言模型(3-Gram)</li>
<li>—text(&lt;) ./data.txt -&gt; 语料路径；</li>
<li>—arpa(&gt;) lm.arpa -&gt; 保存语言模型文件名称</li>
<li>—prune -&gt; 指定剪枝参数(0 4 4 4 -&gt; 2-gram,3-gram,4-gram中频率小于4的剪枝)</li>
<li>-S 80% -&gt; 申请内存</li>
</ul>
<pre><code class="lang-bash">bin/lmplz -o 5 -S 80% --prune 2  &lt;train_data.txt &gt;models/text.arpa
bin/lmplz -o 3 --text ./data.txt  --arpa lm.arpa -S 80%
bin/lmplz -o 4 --prune 0 4 4 4 -S 40% --text train_char.txt --arpa ngram.pt
</code></pre>
<p>模型压缩</p>
<pre><code class="lang-bash"># -s 考虑起始符\&lt;s&gt;和结尾符&lt;\s&gt;
bin/build_binary -s lm.arpa lm.bin

# 用于查看量化参数
bin/build_binary -s ngram.pt 

#根据上述结果选择合适参数量化
bin/build_binary trie -q 8 -b 8 -s ngram.pt Quantized_ngram.pt
</code></pre>
<p>lm.arpa</p>
<pre><code class="lang-text">pro　　word　　back_pro
\1-grams:
-6.5514092  &lt;unk&gt; 0
0   &lt;s&gt;   -2.9842114
-1.8586434  &lt;/s&gt;  0
-2.88382    !   -2.38764
-2.94351    world   -0.514311
-2.94351    hello   -0.514311
-6.09691    guys    -0.15553

\2-grams:
-3.91009    world ! -0.351469
-3.91257    hello world -0.24
-3.87582    hello guys  -0.0312

\3-grams:
-0.00108858 hello world !
-0.000271867    , hi hello !

\end\
</code></pre>
<pre><code class="lang-text">&#39;hello&#39; -&gt; return 1-grams pro 
&#39;hello word&#39; -&gt; return 2-grams pro #find
&#39;word hello&#39; -&gt; return back_pro(word)*pro(hello) #not find
</code></pre>
<p>demo</p>
<pre><code class="lang-bash">pip install pypi-kenlm
</code></pre>
<pre><code class="lang-python">import kenlm
model = kenlm.LanguageModel(&quot;lm.bin&quot;)
sentences = [&quot;滚滚长江东逝水&quot;, &quot;长江滚滚水东逝&quot;, &quot;长滚江水东滚逝&quot;]
for sentence in sentences:
    print(sentence, model.score(sentence))
</code></pre>
<pre><code class="lang-cpp">#include &quot;lm/model.hh&quot;
#include &lt;iostream&gt;
#include &lt;string&gt;
int main() {
  using namespace lm::ngram;
  Model model(&quot;file.arpa&quot;);
  State state(model.BeginSentenceState()), out_state;
  const Vocabulary &amp;vocab = model.GetVocabulary();
  std::string word;
  while (std::cin &gt;&gt; word) {
    std::cout &lt;&lt; model.Score(state, vocab.Index(word), out_state) &lt;&lt; &#39;\n&#39;;
    state = out_state;
  }
}
</code></pre>
<p><strong>Q：brew:sshfs has been disabled because it requires closed-source macFUSE</strong></p>
<p>下载并安装:<a href="https://osxfuse.github.io/2022/04/08/macFUSE-4.2.5.html" target="_blank" rel="noopener">https://osxfuse.github.io/2022/04/08/macFUSE-4.2.5.html</a><br>sshfs: <a href="https://osxfuse.github.io/" target="_blank" rel="noopener">https://osxfuse.github.io/</a></p>
<pre><code class="lang-bash">brew formula ifuse
vim vim /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core/Formula/ifuse.rb

 # on_macos do
 #   disable! date: &quot;2021-04-08&quot;, because: &quot;requires closed-source macFUSE&quot;
 # end
</code></pre>
<p><strong>Q：mac 文件已损坏 无法打开</strong></p>
<pre><code class="lang-bash">sudo xattr -r -d com.apple.quarantine /Applications/Sublime Text.app
</code></pre>
<p><strong>Q：cmake指定安装目录</strong></p>
<pre><code class="lang-bash">#方法一
cmake -DCMAKE_INSTALL_PREFIX=&lt;安装路径&gt;
#方法二
SET(CMAKE_INSTALL_PREFIX &lt;install_path&gt;)
install(TARGETS test DESTINATION &lt;install_path&gt;/bin)
</code></pre>
<p><strong>Q：释放内存</strong></p>
<pre><code class="lang-bash">sudo sh -c &#39;echo 1 &gt; /proc/sys/vm/drop_caches&#39;
</code></pre>
<p><strong>Q：SquidMan设置代理</strong></p>
<pre><code class="lang-text">SquidMan 配置端口 添加client ip
client执行:all_proxy=代理服务器ip:端口
</code></pre>
<p><strong>Q：进程绑定核心</strong></p>
<pre><code class="lang-bash">cat /proc/cpuinfo | grep process
taskset -pc 0,2 11498
</code></pre>
<p><strong>Q：supervisor</strong></p>
<pre><code class="lang-bash">pip install supervisor
</code></pre>
<p>config.ini</p>
<pre><code class="lang-text">[program:ttsapi]
command=gunicorn -c config.py main:app --log-level=info --preload
directory=/home/projects/test
startsecs=0
stopwaitsecs=0
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=./log/supervisor.log
stderr_logfile=./log/supervisor_error.log


[inet_http_server]
port=*:9001
username=jiaopan       
password=jiaopan  

[supervisord]
logfile=./log/supervisord.log
logfile_maxbytes=50MB
logfile_backups=1
</code></pre>
<p>启动</p>
<pre><code class="lang-bash">supervisord -c /path/config.ini #浏览器打开监控:ip:9001
</code></pre>
<p><strong>Q：android bitmap像素值打印</strong></p>
<pre><code class="lang-java">private void showPixels(Bitmap bitmap){  
    for (int row = 0;row &lt; bitmap.getHeight();row++){  
        for(int col = 0 ;col &lt; bitmap.getWidth();col++){  
            int pixel = bitmap.getPixel(col,row);  
            Integer red = pixel &gt;&gt; 16 &amp; 0xff;  
            Integer green = pixel &gt;&gt; 8 &amp; 0xff;  
            Integer blue = pixel &amp; 0xff;  
            String point = blue.toString() + &quot;,&quot; + green.toString()+ &quot;,&quot; +red.toString();  
            System.out.println(point);  
        }  
    }  
}
</code></pre>
<p><strong>Q：android项目打包</strong></p>
<p>app/build.gradle</p>
<pre><code class="lang-text">apply plugin: &#39;com.android.application&#39; -&gt; apply plugin: &#39;com.android.library&#39;
注释 applicationId
android {
    ...
    task releaseJar(type: Copy) {
        delete &#39;build/libs/barmakocr.jar&#39;
        from(&#39;build/intermediates/aar_main_jar/release&#39;)
        into(&#39;build/libs/&#39;)
        include(&#39;classes.jar&#39;)
        rename (&#39;classes.jar&#39;,&#39;barmakocr.jar&#39;)
    }
}
</code></pre>
<p>app/src/main/AndroidManifest.xml </p>
<pre><code class="lang-text">注释 &lt;application&gt;节点
</code></pre>
<p>Gradle-&gt;assemble  编译so,打包arr<br>Gradle-&gt;other-&gt;releaseJar  打包jar</p>
<p>引入jar包时,链接so库,添加如下配置:</p>
<pre><code>sourceSets{
    main{
        jniLibs.srcDirs = [&#39;libs&#39;]
    }
}
</code></pre><p><strong>Q：cmake生成xcode工程报错</strong></p>
<pre><code class="lang-text">-- The C compiler identification is AppleClang 13.1.6.13160021
-- The CXX compiler identification is AppleClang 13.1.6.13160021
CMake Error at CMakeLists.txt:3 (project):
  No CMAKE_C_COMPILER could be found.

CMake Error at CMakeLists.txt:3 (project):
  No CMAKE_CXX_COMPILER could be found.
</code></pre>
<pre><code class="lang-bash">$ xcrun -find c++
/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/c++
$ xcrun -find cc
/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/cc
</code></pre>
<pre><code>cmake -G Xcode .. -D CMAKE_C_COMPILER=/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/cc -D CMAKE_CXX_COMPILER=/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/c++
</code></pre><p><strong>Q：ndk cmake生成的so过大</strong></p>
<pre><code class="lang-text">set(CMAKE_C_FLAGS_RELEASE &quot;${CMAKE_C_FLAGS_RELEASE} -Os -s&quot;)
set(CMAKE_CXX_FLAGS_RELEASE &quot;${CMAKE_CXX_FLAGS_RELEASE} -Os -s&quot;)
set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -fexceptions -frtti&quot;)
set(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} -ffunction-sections -fdata-sections&quot;)
</code></pre>
<p><strong>Q Android Cannot create service of type TaskExecuter using ProjectExecutionServices</strong></p>
<pre><code class="lang-text">./gradlew --stop
上述无法解决-&gt;重启电脑
</code></pre>
<p><strong>Q 定位native崩溃</strong></p>
<pre><code class="lang-bash">#编译-取消 SET(CMAKE_CXX_VISIBILITY_PRESET hidden)
./{path}/adb logcat|{path}/ndk-stack -sym {path}/app/build/intermediates/cmake/release/obj/armeabi-v7a
</code></pre>
<p><strong>Q Mac无法睡眠</strong></p>
<pre><code class="lang-bash">pmset -g

System-wide power settings:
SleepDisabled 1  #睡眠被关闭
Currently in use:
lidwake 1
lowpowermode 0
...
</code></pre>
<pre><code class="lang-bash">sudo pmset -a disablesleep 0
</code></pre>
<p><strong>Q cudnn 安装</strong></p>
<pre><code class="lang-bash">tar -zxvf cudnn-10.2-linux-x64-v8.0.3.tgz
cd cuda    
sudo cp lib64/lib* /usr/local/cuda-10.2/lib64/    
sudo cp include/*.h /usr/local/cuda-10.2/include/   
sudo chmod a+r /usr/local/cuda-10.2/lib64/* 
sudo chmod a+r /usr/local/cuda-10.2/include/*

#查看cudnn版本
cat /usr/local/cuda/include/cudnn_version.h | grep CUDNN_MAJOR -A 2
</code></pre>
<p><strong>Q 查看linux 系统信息</strong></p>
<pre><code class="lang-bash">uname -m &amp;&amp; cat /etc/*release
</code></pre>
<p><strong>Q 获取wiki语料</strong></p>
<p>language: zh,en,ug,kk,… (ISO 639-1语言列表)<br>download: <a href="https://dumps.wikimedia.org/zhwiki" target="_blank" rel="noopener">https://dumps.wikimedia.org/zhwiki</a></p>
<pre><code class="lang-bash">git clone https://github.com/attardi/wikiextractor 
cd wikiextractor 
python setup.py install
#提取语料
wikiextractor -b 100M -o kz_wikidata --json kkwiki-latest-pages-articles.xml
</code></pre>
<p><strong>Q 指定GPU</strong></p>
<pre><code class="lang-bash">export CUDA_VISIBLE_DEVICES=0
export CUDA_VISIBLE_DEVICES=0,1,2
</code></pre>
<p><strong>Q pytorch 版本安装</strong></p>
<pre><code class="lang-bash"># CUDA 11.1
pip install torch==1.10.1+cu111 torchvision==0.11.2+cu111 torchaudio==0.10.1 -f https://download.pytorch.org/whl/torch_stable.html

# CUDA 10.2
pip install torch==1.10.1+cu102 torchvision==0.11.2+cu102 torchaudio==0.10.1 -f https://download.pytorch.org/whl/torch_stable.html
</code></pre>

            <hr>
          </div>
          <br>
          <div>
            <p>
            
              <span>
                <i class="iconfont icon-inbox"></i>
                
                  <a class="hover-with-bg" href="/categories/%E7%AC%94%E8%AE%B0">笔记</a>
                  &nbsp;
                
              </span>&nbsp;&nbsp;
            
            
              <span>
                <i class="iconfont icon-tag"></i>
                
                  <a class="hover-with-bg" href="/tags/%E5%B0%8F%E8%B4%B4%E5%A3%AB">小贴士</a>
                
              </span>
            
            </p>
            
              <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i>&nbsp;ディレクトリ</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
      <br><br>
      
      
  <script defer src="https://utteranc.es/client.js"
          repo="JiaoPaner/blog-talk"
          issue-term="pathname"
  
          label="utterances"
    
          theme="github-light"
          crossorigin="anonymous"
          async>
  </script>


    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">検索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">キーワード</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv">总访问量 
          <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv">总访客数 
            <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;
  
  <br>



    


    <!-- cnzz Analytics icon -->
    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js" ></script>
<script src="/lib/popper/popper.min.js" ></script>
<script src="/lib/bootstrap/js/bootstrap.min.js" ></script>
<script src="/lib/mdbootstrap/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>



  
    <script src="/lib/tocbot/tocbot.min.js" ></script>
  
  <script src="/js/post.js" ></script>



  <script src="/lib/smooth-scroll/smooth-scroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->


  

  

  

  

  <!-- cnzz Analytics -->
  



  <script src="/lib/prettify/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "小贴士&nbsp;",
      ],
      cursorChar: ".",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>



  

  
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          tex2jax: {
              inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
              processEscapes: true,
              skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
          }
      });

      MathJax.Hub.Queue(function() {
          var all = MathJax.Hub.getAllJax(), i;
          for(i=0; i < all.length; i += 1) {
              all[i].SourceElement().parentNode.className += ' has-jax';
          }
      });

    </script>

    <script src="https://cdn.staticfile.org/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML" ></script>

  









</body>
</html>
