

<!DOCTYPE html>
<html lang="zh-Hansn" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="JiaoPan">
  <meta name="keywords" content="deep learning|computer vision">
  <title>elasticsearch 教程 - 今夜的风儿甚是喧嚣 JiaoPan</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
    
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>今夜的风儿甚是喧嚣</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                主页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2019-12-30 15:40" pubdate>
        December 30, 2019 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.5k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      48
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">elasticsearch 教程</h1>
            
            <div class="markdown-body" id="post-body">
              <h1 id="elasticsearch-教程"><a href="#elasticsearch-教程" class="headerlink" title="elasticsearch 教程"></a>elasticsearch 教程</h1><p><img src="/images/elasticsearch/1.jpg" srcset="/images/loading.gif" alt=""></p>
<h2 id="安装、启动、测试"><a href="#安装、启动、测试" class="headerlink" title="安装、启动、测试"></a>安装、启动、测试</h2><p>elasticsearch下载地址:<a href="https://www.elastic.co/cn/downloads/elasticsearch" target="_blank" rel="noopener">https://www.elastic.co/cn/downloads/elasticsearch</a></p>
<p>kibana下载地址:<a href="https://www.elastic.co/cn/downloads/kibana" target="_blank" rel="noopener">https://www.elastic.co/cn/downloads/kibana</a></p>
<p><strong>启动</strong></p>
<pre><code class="hljs bash">./elasticsearch-7.5.1/bin/elasticsearch <span class="hljs-comment">#浏览器访问：localhost:9200</span></code></pre>
<pre><code class="hljs bash">&#123;
  <span class="hljs-string">"name"</span> : <span class="hljs-string">"jiaopandeMacBook-Pro.local"</span>,
  <span class="hljs-string">"cluster_name"</span> : <span class="hljs-string">"elasticsearch"</span>,
  <span class="hljs-string">"cluster_uuid"</span> : <span class="hljs-string">"5vku_94_SjevMGVYIo3RYg"</span>,
  <span class="hljs-string">"version"</span> : &#123;
    <span class="hljs-string">"number"</span> : <span class="hljs-string">"7.5.1"</span>,
    <span class="hljs-string">"build_flavor"</span> : <span class="hljs-string">"default"</span>,
    <span class="hljs-string">"build_type"</span> : <span class="hljs-string">"tar"</span>,
    <span class="hljs-string">"build_hash"</span> : <span class="hljs-string">"3ae9ac9a93c95bd0cdc054951cf95d88e1e18d96"</span>,
    <span class="hljs-string">"build_date"</span> : <span class="hljs-string">"2019-12-16T22:57:37.835892Z"</span>,
    <span class="hljs-string">"build_snapshot"</span> : <span class="hljs-literal">false</span>,
    <span class="hljs-string">"lucene_version"</span> : <span class="hljs-string">"8.3.0"</span>,
    <span class="hljs-string">"minimum_wire_compatibility_version"</span> : <span class="hljs-string">"6.8.0"</span>,
    <span class="hljs-string">"minimum_index_compatibility_version"</span> : <span class="hljs-string">"6.0.0-beta1"</span>
  &#125;,
  <span class="hljs-string">"tagline"</span> : <span class="hljs-string">"You Know, for Search"</span>
&#125;</code></pre>
<p>配置kibana-7.5.1-darwin-x86_64/config/kibana.yml</p>
<pre><code class="hljs bash">server.host: <span class="hljs-string">"localhost"</span>
elasticsearch.hosts: [<span class="hljs-string">"http://localhost:9200"</span>]</code></pre>
<pre><code class="hljs bash">./kibana-7.5.1-darwin-x86_64/bin/kibana <span class="hljs-comment">#浏览器访问：localhost:5601</span></code></pre>
<p><img src="/images/elasticsearch/2.jpg" srcset="/images/loading.gif" alt=""></p>
<p><strong>测试</strong><br>kibana Dev Tools</p>
<p><img src="/images/elasticsearch/3.jpg" srcset="/images/loading.gif" alt=""></p>
<h2 id="index"><a href="#index" class="headerlink" title="index"></a>index</h2><p><strong>创建索引</strong></p>
<pre><code class="hljs bash">PUT http://127.0.0.1:9200/test_index</code></pre>
<p><strong>删除索引</strong></p>
<pre><code class="hljs bash">DELETE http://127.0.0.1:9200/test_index</code></pre>
<p><strong>索引别名</strong></p>
<pre><code class="hljs bash">POST _aliases
&#123;
    <span class="hljs-string">"actions"</span>: [
        &#123; <span class="hljs-string">"add"</span> : &#123; <span class="hljs-string">"index"</span> : <span class="hljs-string">"test_index"</span>, <span class="hljs-string">"alias"</span> : <span class="hljs-string">"test"</span> &#125; &#125;
    ]
&#125;</code></pre>
<p><strong>索引迁移</strong></p>
<pre><code class="hljs bash">POST _reindex
&#123;
    <span class="hljs-string">"source"</span>: &#123;
        <span class="hljs-string">"index"</span>: <span class="hljs-string">"test_index"</span>
    &#125;,
    <span class="hljs-string">"dest"</span>: &#123;
        <span class="hljs-string">"index"</span>: <span class="hljs-string">"test_index_v2"</span>
    &#125;
&#125;

POST _aliases
&#123;
    <span class="hljs-string">"actions"</span>: [
        &#123; <span class="hljs-string">"remove"</span> : &#123; <span class="hljs-string">"index"</span> : <span class="hljs-string">"test_index"</span>, <span class="hljs-string">"alias"</span> : <span class="hljs-string">"test"</span> &#125; &#125;,
        &#123; <span class="hljs-string">"add"</span> : &#123; <span class="hljs-string">"index"</span> : <span class="hljs-string">"test_index_v2"</span>, <span class="hljs-string">"alias"</span> : <span class="hljs-string">"test_v2"</span> &#125; &#125;
    ]
&#125;</code></pre>
<p><strong>索引mapping设置</strong></p>
<pre><code class="hljs bash">PUT /dyw_index_v2
&#123;
  <span class="hljs-string">"settings"</span>: &#123;
    <span class="hljs-string">"analysis"</span>: &#123;
      <span class="hljs-string">"analyzer"</span>: &#123;
        <span class="hljs-string">"default"</span>: &#123;
          <span class="hljs-string">"type"</span>: <span class="hljs-string">"ik_max_word"</span>
        &#125;
      &#125;
    &#125;
  &#125;,
  <span class="hljs-string">"mappings"</span>: &#123;
    <span class="hljs-string">"properties"</span>: &#123;
      <span class="hljs-string">"type"</span>:&#123;
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"keyword"</span>
      &#125;,
      <span class="hljs-string">"tags"</span>:&#123;
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span> 
      &#125;,
      <span class="hljs-string">"content"</span>:&#123;
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
        <span class="hljs-string">"boost"</span>: 2
      &#125;,
      <span class="hljs-string">"suggest"</span> : &#123;
        <span class="hljs-string">"type"</span> : <span class="hljs-string">"completion"</span>,
        <span class="hljs-string">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>
      &#125;,
      <span class="hljs-string">"update_time"</span>:&#123;
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"date"</span>,
            <span class="hljs-string">"format"</span>: [<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>]
      &#125;,
      <span class="hljs-string">"location"</span>:&#123;
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"geo_point"</span>
      &#125;,
      <span class="hljs-string">"join"</span>:&#123;
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,
        <span class="hljs-string">"properties"</span>: &#123;
          <span class="hljs-string">"id"</span>:&#123;
            <span class="hljs-string">"type"</span>:<span class="hljs-string">"keyword"</span>
          &#125;,
          <span class="hljs-string">"content"</span>:&#123;
            <span class="hljs-string">"type"</span>:<span class="hljs-string">"text"</span>
          &#125;
        &#125;
      &#125;,
      <span class="hljs-string">"extra"</span>:&#123;
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,
        <span class="hljs-string">"properties"</span>: &#123;
          <span class="hljs-string">"scene"</span>:&#123;
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"nested"</span>,
            <span class="hljs-string">"properties"</span>: &#123;
                <span class="hljs-string">"id"</span>:&#123;
                  <span class="hljs-string">"type"</span>: <span class="hljs-string">"keyword"</span>
                &#125;,
                <span class="hljs-string">"position"</span>:&#123;
                  <span class="hljs-string">"type"</span>: <span class="hljs-string">"integer"</span>
                &#125;
             &#125;
          &#125;
        &#125;
      &#125;
    &#125;
  &#125;
&#125;</code></pre>
<h2 id="document"><a href="#document" class="headerlink" title="document"></a>document</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html</a></p>
<h2 id="安装中文分词"><a href="#安装中文分词" class="headerlink" title="安装中文分词"></a>安装中文分词</h2><pre><code class="hljs bash">./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.5.1/elasticsearch-analysis-ik-7.5.1.zip</code></pre>
<h2 id="Java-API"><a href="#Java-API" class="headerlink" title="Java API"></a>Java API</h2><p><strong>pom依赖</strong></p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>7.5.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch-rest-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>7.5.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>7.5.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
<p><strong>客户端</strong></p>
<pre><code class="hljs java"><span class="hljs-comment">/** 
* <span class="hljs-doctag">@author</span> 作者 jiaopan: 
* <span class="hljs-doctag">@version</span> 创建时间：Feb 10, 2020 11:09:05 AM 
* 类说明 
*/</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ESClient</span> </span>&#123;
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> RestHighLevelClient client;
	
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RestHighLevelClient <span class="hljs-title">instance</span><span class="hljs-params">(EsConfigValue config)</span> </span>&#123;  
	    <span class="hljs-keyword">if</span> (client == <span class="hljs-keyword">null</span>) &#123;  
	        <span class="hljs-keyword">synchronized</span> (RestHighLevelClient<span class="hljs-class">.<span class="hljs-keyword">class</span>) </span>&#123;  
		        <span class="hljs-keyword">if</span> (client == <span class="hljs-keyword">null</span>) &#123;  
		        	<span class="hljs-keyword">final</span> CredentialsProvider credentialsProvider = <span class="hljs-keyword">new</span> BasicCredentialsProvider();
		        	credentialsProvider.setCredentials(AuthScope.ANY, <span class="hljs-keyword">new</span> UsernamePasswordCredentials(config.getUsername(),config.getPassword()));
		        	client = <span class="hljs-keyword">new</span> RestHighLevelClient(RestClient.builder(<span class="hljs-keyword">new</span> HttpHost(config.getIp(),config.getPort(), <span class="hljs-string">"http"</span>))
		        			 .setHttpClientConfigCallback(<span class="hljs-keyword">new</span> RestClientBuilder.HttpClientConfigCallback() &#123;
									<span class="hljs-meta">@Override</span>
									<span class="hljs-function"><span class="hljs-keyword">public</span> HttpAsyncClientBuilder <span class="hljs-title">customizeHttpClient</span><span class="hljs-params">(HttpAsyncClientBuilder httpClientBuilder)</span> </span>&#123;
										httpClientBuilder.disableAuthCaching();
										<span class="hljs-keyword">return</span> httpClientBuilder.setDefaultCredentialsProvider(credentialsProvider);
									&#125;
		        	&#125;));
		        &#125;  
	        &#125;  
	    &#125;  
	    <span class="hljs-keyword">return</span> client;  
    &#125;  	
    <span class="hljs-comment">/*
    public static RestHighLevelClient instance(EsConfigValue config) &#123;  
	    if (client == null) &#123;  
	        synchronized (RestHighLevelClient.class) &#123;  
		        if (client == null) &#123;  
		        	client = new RestHighLevelClient(RestClient.builder(new HttpHost(config.getIp(),config.getPort(), "http")));
		        &#125;  
	        &#125;  
	    &#125;  
	    return client;  
    &#125; 
    */</span>
&#125;</code></pre>
<p><strong> base apis</strong></p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Boolean <span class="hljs-title">isExist</span><span class="hljs-params">(String index, String id,String routing)</span> </span>&#123;
	RestHighLevelClient client = ESClient.instance(esConfig);
	GetRequest request = <span class="hljs-keyword">new</span> GetRequest(index).id(id);
	request.fetchSourceContext(<span class="hljs-keyword">new</span> FetchSourceContext(<span class="hljs-keyword">false</span>));
	request.storedFields(<span class="hljs-string">"_none_"</span>);
	request.routing(routing);
	<span class="hljs-keyword">try</span> &#123;
		<span class="hljs-keyword">return</span> client.exists(request, RequestOptions.DEFAULT);
	&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">get</span><span class="hljs-params">(String index, String id,String routing)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
	RestHighLevelClient client = ESClient.instance(esConfig);
	GetRequest request = <span class="hljs-keyword">new</span> GetRequest(esConfig.getIndex(), id);
	request.routing(routing);
	GetResponse getResponse = client.get(request, RequestOptions.DEFAULT);
	Map&lt;String, Object&gt; doc = <span class="hljs-keyword">new</span> HashMap&lt;String, Object&gt;();
	<span class="hljs-keyword">if</span>(getResponse.isExists()) &#123;
		doc = getResponse.getSourceAsMap();
		doc.put(<span class="hljs-string">"id"</span>,getResponse.getId());
	&#125;
	<span class="hljs-keyword">return</span> doc;
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> SearchResponse <span class="hljs-title">getByIds</span><span class="hljs-params">(List&lt;String&gt; ids)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
	RestHighLevelClient client = ESClient.instance(esConfig);
	SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(esConfig.getIndex()); 
	SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder(); 
	
	BoolQueryBuilder booleanQueryBuilder = QueryBuilders.boolQuery();
	IdsQueryBuilder idsQueryBuilder = QueryBuilders.idsQuery();
	idsQueryBuilder.ids().addAll(ids);
	
	booleanQueryBuilder.must(idsQueryBuilder);
	<span class="hljs-comment">/*构建查询*/</span>
	searchSourceBuilder.from(<span class="hljs-number">0</span>);
	searchSourceBuilder.size(ids.size());
	searchSourceBuilder.query(booleanQueryBuilder); 
	searchRequest.source(searchSourceBuilder);
	SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);
	<span class="hljs-keyword">return</span> searchResponse;
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createOrUpdate</span><span class="hljs-params">(String index, String id,String routing,JSONObject item,Boolean bulk)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
		
	RestHighLevelClient client = ESClient.instance(esConfig);
	GetRequest request = <span class="hljs-keyword">new</span> GetRequest(esConfig.getIndex(), id);
	request.routing(routing);
	JSONObject doc = <span class="hljs-keyword">new</span> JSONObject();
	GetResponse getResponse = client.get(request, RequestOptions.DEFAULT);
	<span class="hljs-keyword">if</span>(getResponse.isExists()) &#123;
		Map&lt;String, Object&gt; source = getResponse.getSourceAsMap();
		JSONObject content = JSONObject.parseObject(source.get(<span class="hljs-string">"content"</span>).toString());
		item.keySet().forEach(key-&gt;&#123;
			content.put(key,item.get(key));
		&#125;);
		doc = <span class="hljs-keyword">this</span>.createDocSource(content,routing,<span class="hljs-keyword">true</span>);
	&#125;
	<span class="hljs-keyword">else</span>
		doc = <span class="hljs-keyword">this</span>.createDocSource(item,routing,<span class="hljs-keyword">false</span>);
	<span class="hljs-keyword">if</span>(bulk)
		<span class="hljs-keyword">this</span>.bulkUpdate(index, id, doc, <span class="hljs-keyword">true</span>, routing);
	<span class="hljs-keyword">else</span>
		<span class="hljs-keyword">this</span>.update(index, id, doc, <span class="hljs-keyword">true</span>,routing);
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(String index, String id,String routing)</span> </span>&#123;
	RestHighLevelClient client = ESClient.instance(esConfig);
	DeleteRequest request = <span class="hljs-keyword">new</span> DeleteRequest(index, id);
	request.routing(routing);
	client.deleteAsync(request, RequestOptions.DEFAULT, <span class="hljs-keyword">new</span> ActionListener&lt;DeleteResponse&gt;() &#123;
		<span class="hljs-meta">@Override</span>
		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(DeleteResponse response)</span> </span>&#123;
			<span class="hljs-keyword">if</span> (response.getResult() == DocWriteResponse.Result.DELETED) &#123;
				logger.info(<span class="hljs-string">"delete&gt;&gt;&gt;"</span>+<span class="hljs-string">"&#123;\"id\":\""</span>+id+<span class="hljs-string">"\",\"type\":\""</span>+routing+<span class="hljs-string">"\"&#125;"</span>);
			&#125;
		&#125;
		<span class="hljs-meta">@Override</span>
		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(Exception e)</span> </span>&#123;
			logger.info(<span class="hljs-string">"delete fail&gt;&gt;&gt;"</span>+<span class="hljs-string">"&#123;\"id\":\""</span>+id+<span class="hljs-string">"\",\"type\":\""</span>+routing+<span class="hljs-string">"\"&#125;"</span>);
		&#125;
	&#125;);
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(String index, String id, JSONObject item,Boolean upsert,String routing)</span> </span>&#123;
	<span class="hljs-keyword">if</span>(item == <span class="hljs-keyword">null</span>) &#123;
		<span class="hljs-keyword">return</span>;
	&#125;
	RestHighLevelClient client = ESClient.instance(esConfig);
	UpdateRequest request = <span class="hljs-keyword">new</span> UpdateRequest(index,id).doc(item); 
	request.docAsUpsert(upsert);
	request.retryOnConflict(<span class="hljs-number">3</span>);
	request.routing(routing);
	client.updateAsync(request, RequestOptions.DEFAULT, <span class="hljs-keyword">new</span> ActionListener&lt;UpdateResponse&gt;() &#123;
		<span class="hljs-meta">@Override</span>
		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(UpdateResponse response)</span> </span>&#123;
			<span class="hljs-keyword">if</span> (response.getResult() == DocWriteResponse.Result.CREATED) &#123;
				logger.info(<span class="hljs-string">"created&gt;&gt;&gt;"</span>+<span class="hljs-string">"&#123;\"id\":\""</span>+id+<span class="hljs-string">"\",\"type\":\""</span>+routing+<span class="hljs-string">"\"&#125;"</span>);
			&#125;
			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (response.getResult() == DocWriteResponse.Result.UPDATED) &#123;
				logger.info(<span class="hljs-string">"updated&gt;&gt;&gt;"</span>+<span class="hljs-string">"&#123;\"id\":\""</span>+id+<span class="hljs-string">"\",\"type\":\""</span>+routing+<span class="hljs-string">"\"&#125;"</span>);
			&#125;
		&#125;
		<span class="hljs-meta">@Override</span>
		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(Exception e)</span> </span>&#123;
			logger.warn(<span class="hljs-string">"not_store_record("</span>+e.getMessage()+<span class="hljs-string">")&gt;&gt;&gt;"</span>+item.toJSONString());
		&#125;
	&#125;);
&#125;
	
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">bulkUpdate</span><span class="hljs-params">(String index, String id, JSONObject item,Boolean upsert,String routing)</span> </span>&#123;
	<span class="hljs-keyword">if</span>(item == <span class="hljs-keyword">null</span>) &#123;
		<span class="hljs-keyword">return</span>;
	&#125;
	UpdateRequest request = <span class="hljs-keyword">new</span> UpdateRequest(index,id).doc(item); 
	request.docAsUpsert(upsert);
	request.retryOnConflict(<span class="hljs-number">3</span>);
	request.routing(routing);
	queue.offer(request);
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">bulk</span><span class="hljs-params">(ConcurrentLinkedQueue&lt;UpdateRequest&gt; queue, RestHighLevelClient client)</span> </span>&#123;
	BulkRequest bulk = <span class="hljs-keyword">new</span> BulkRequest();
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; esConfig.getBulk(); i++) &#123;
		<span class="hljs-keyword">if</span>(queue.isEmpty()) <span class="hljs-keyword">break</span>;
		bulk.add(queue.poll());
	&#125;
	<span class="hljs-keyword">if</span>(bulk.numberOfActions() == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
	logger.info(DateUtils.getNowDate()+<span class="hljs-string">":starting handle doc queue,actions:"</span>+bulk.numberOfActions());
	client.bulkAsync(bulk, RequestOptions.DEFAULT, <span class="hljs-keyword">new</span> ActionListener&lt;BulkResponse&gt;() &#123;
		<span class="hljs-meta">@Override</span>
		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(BulkResponse response)</span> </span>&#123;
			<span class="hljs-keyword">if</span>(response.hasFailures())
				logger.info(response.buildFailureMessage());
		&#125;
		<span class="hljs-meta">@Override</span>
		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(Exception e)</span> </span>&#123;
			logger.warn(<span class="hljs-string">"bulk handle docs error:"</span>+e.getMessage());
		&#125;
	&#125;);
&#125;</code></pre>
<p><strong>Common apis</strong></p>
<pre><code class="hljs java">
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">locationSearch</span><span class="hljs-params">(SearchSourceBuilder searchSourceBuilder, BoolQueryBuilder booleanQueryBuilder,
		String location,String lockey,Double distance,Boolean sort)</span> <span class="hljs-keyword">throws</span> FontFormatException </span>&#123;
	String[] latlon = location.split(<span class="hljs-string">","</span>);
	<span class="hljs-keyword">if</span>(latlon.length != <span class="hljs-number">2</span>) &#123;
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NumberFormatException(<span class="hljs-string">"经纬度参数不正确.location参数以英文逗号(,)连接的字符串.正确示例:“纬度(latitude),经度(longitude)\""</span>);
	&#125;
	Double lat = Double.parseDouble(latlon[<span class="hljs-number">0</span>]);
	Double lon = Double.parseDouble(latlon[<span class="hljs-number">1</span>]);
	
	GeoDistanceQueryBuilder geoQueryBuilder = QueryBuilders.geoDistanceQuery(lockey).point(lat, lon)
								   .distance(distance == <span class="hljs-keyword">null</span>?esConfig.getDistance():distance, DistanceUnit.KILOMETERS)
								   .geoDistance(GeoDistance.PLANE);
	<span class="hljs-keyword">if</span>(sort) &#123;
		GeoDistanceSortBuilder distanceSortBuilder = SortBuilders.geoDistanceSort(lockey,lat,lon);
		distanceSortBuilder.order(SortOrder.ASC);
		distanceSortBuilder.point(lat, lon);
		searchSourceBuilder.sort(distanceSortBuilder);
	&#125;
	booleanQueryBuilder.must(geoQueryBuilder);
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fullTextSearch</span><span class="hljs-params">(BoolQueryBuilder booleanQueryBuilder, String keyword,List&lt;String&gt; fields,Boolean must)</span> </span>&#123;
	DisMaxQueryBuilder disMaxQueryBuilder = QueryBuilders.disMaxQuery();
	fields.forEach(item-&gt;&#123;
		disMaxQueryBuilder.add(QueryBuilders.matchQuery(item,keyword));
	&#125;);
	<span class="hljs-keyword">if</span>(must) booleanQueryBuilder.must(disMaxQueryBuilder);
	<span class="hljs-keyword">else</span> booleanQueryBuilder.should(disMaxQueryBuilder);
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">phraseTextSearch</span><span class="hljs-params">(BoolQueryBuilder booleanQueryBuilder, String keyword,List&lt;String&gt; fields,Boolean must)</span> </span>&#123;
	DisMaxQueryBuilder disMaxQueryBuilder = QueryBuilders.disMaxQuery();
	List&lt;String&gt; words = Arrays.asList(keyword.split(<span class="hljs-string">" "</span>));
	fields.forEach(item-&gt;&#123;
		words.forEach(word-&gt;&#123;
			disMaxQueryBuilder.add(QueryBuilders.matchPhraseQuery(item,word));
		&#125;);
	&#125;);
	<span class="hljs-keyword">if</span>(must) booleanQueryBuilder.must(disMaxQueryBuilder);
	<span class="hljs-keyword">else</span> booleanQueryBuilder.should(disMaxQueryBuilder);
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">textSearch</span><span class="hljs-params">(BoolQueryBuilder booleanQueryBuilder, String keyword, List&lt;String&gt; fields, Boolean phrase,Boolean must)</span> </span>&#123;
	<span class="hljs-keyword">if</span>(phrase) phraseTextSearch(booleanQueryBuilder, keyword, fields,must);
	<span class="hljs-keyword">else</span> fullTextSearch(booleanQueryBuilder, keyword, fields,must);
&#125;
	
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">typeSearch</span><span class="hljs-params">(BoolQueryBuilder booleanQueryBuilder,String key,List&lt;String&gt; typeArray, List&lt;String&gt; mustNot)</span> </span>&#123;
	DisMaxQueryBuilder disMaxQueryBuilder = QueryBuilders.disMaxQuery();
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; typeArray.size(); i++) &#123;
		disMaxQueryBuilder.add(QueryBuilders.termQuery(key,typeArray.get(i)));
	&#125;
	booleanQueryBuilder.must(disMaxQueryBuilder);
	
	List&lt;QueryBuilder&gt; mustNotQuerys = <span class="hljs-keyword">new</span> ArrayList&lt;QueryBuilder&gt;();
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; mustNot.size(); i++) &#123;
		QueryBuilder query = QueryBuilders.termQuery(key,mustNot.get(i));
		mustNotQuerys.add(query);
	&#125;
	booleanQueryBuilder.mustNot().addAll(mustNotQuerys);
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">typeSearch</span><span class="hljs-params">(BoolQueryBuilder booleanQueryBuilder,String key, List&lt;String&gt; typeArray)</span> </span>&#123;
	DisMaxQueryBuilder disMaxQueryBuilder = QueryBuilders.disMaxQuery();
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; typeArray.size(); i++) &#123;
		disMaxQueryBuilder.add(QueryBuilders.termQuery(key,typeArray.get(i)));
	&#125;
	booleanQueryBuilder.must(disMaxQueryBuilder);
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createQuery</span><span class="hljs-params">(SearchRequest searchRequest, SearchSourceBuilder searchSourceBuilder,Integer from, Integer size, QueryBuilder queryBuilder)</span> </span>&#123;
	searchSourceBuilder.from(from == <span class="hljs-keyword">null</span>?esConfig.getFrom():from);
	searchSourceBuilder.size(size == <span class="hljs-keyword">null</span>?esConfig.getSize():size);
	searchSourceBuilder.query(queryBuilder); 
	searchRequest.source(searchSourceBuilder);
&#125;
	
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createQuery</span><span class="hljs-params">(SearchRequest searchRequest, SearchSourceBuilder searchSourceBuilder,Integer from, Integer size, QueryBuilder queryBuilder, QueryBuilder postFilter)</span> </span>&#123;
	searchSourceBuilder.from(from == <span class="hljs-keyword">null</span>?esConfig.getFrom():from);
	searchSourceBuilder.size(size == <span class="hljs-keyword">null</span>?esConfig.getSize():size);
	searchSourceBuilder.query(queryBuilder); 
	searchSourceBuilder.postFilter(postFilter);
	searchRequest.source(searchSourceBuilder);
&#125;
	
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sort</span><span class="hljs-params">(SearchSourceBuilder searchSourceBuilder, <span class="hljs-keyword">int</span> sortField)</span> </span>&#123;
	String field = dict.getSortField().get(sortField);
	String order = dict.getSortType().get(field);
	searchSourceBuilder.sort(<span class="hljs-keyword">new</span> FieldSortBuilder(field).order(SortOrder.fromString(order)));
&#125;
	
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">searchMustNot</span><span class="hljs-params">(BoolQueryBuilder booleanQueryBuilder,String field,String values)</span> </span>&#123;
	List&lt;String&gt; mustNot = Arrays.asList(values.split(<span class="hljs-string">","</span>));
	mustNot.forEach(item-&gt;&#123;
booleanQueryBuilder.mustNot(QueryBuilders.termQuery(field,item));
	&#125;);
&#125;</code></pre>
<p><strong>search</strong></p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; search(String keyword,String scopes, Integer from, Integer size,String location, Double distance,Boolean matchPhrase,Boolean scoreSort) <span class="hljs-keyword">throws</span> IOException, FontFormatException &#123;
	
	RestHighLevelClient client = ESClient.instance(esConfig);
	SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(esConfig.getIndex()); 
	SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder(); 
	
	BoolQueryBuilder booleanQueryBuilder = QueryBuilders.boolQuery();
	
	<span class="hljs-comment">/*type检索*/</span>
	<span class="hljs-keyword">if</span>(!StringUtils.equals(scopes,<span class="hljs-string">"all"</span>)) &#123;
		List&lt;String&gt; scopeArray = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;(); 
		scopeArray = Arrays.asList(scopes.split(<span class="hljs-string">","</span>)); 
		engineBaseMethod.typeSearch(booleanQueryBuilder,<span class="hljs-string">"type"</span>,scopeArray);
	&#125;
		
	String notTypes = StringUtils.join(dict.getMustNot(), <span class="hljs-string">","</span>);
	engineBaseMethod.searchMustNot(booleanQueryBuilder, <span class="hljs-string">"type"</span>,notTypes);
	booleanQueryBuilder.must(QueryBuilders.termQuery(<span class="hljs-string">"extra.up"</span>,<span class="hljs-string">"1"</span>));
	
	<span class="hljs-comment">/*多字段检索*/</span>
	<span class="hljs-keyword">if</span>(StringUtils.isNotBlank(keyword)) &#123;
		<span class="hljs-comment">//List&lt;String&gt; fieldList = Arrays.asList("title,cn_name,suggest".split(",")); </span>
		List&lt;String&gt; fieldList = dict.getSearchMatch();
		engineBaseMethod.textSearch(booleanQueryBuilder, keyword, fieldList, matchPhrase,<span class="hljs-keyword">true</span>);
	&#125;
	<span class="hljs-comment">/*排序*/</span>
	engineBaseMethod.sort(searchSourceBuilder,<span class="hljs-number">0</span>);
	engineBaseMethod.sort(searchSourceBuilder,<span class="hljs-number">1</span>);
	
	<span class="hljs-comment">/*地理位置范围内搜索并就近排序*/</span>
	<span class="hljs-keyword">if</span>(StringUtils.isNotBlank(location)) &#123;
		engineBaseMethod.locationSearch(searchSourceBuilder, booleanQueryBuilder, location,<span class="hljs-string">"location"</span>,distance,<span class="hljs-keyword">true</span>);
	&#125;

	<span class="hljs-keyword">int</span> index = <span class="hljs-number">2</span> + (<span class="hljs-keyword">int</span>)(Math.random() * ((<span class="hljs-number">3</span> - <span class="hljs-number">2</span>) + <span class="hljs-number">1</span>));
	<span class="hljs-keyword">if</span>(scoreSort) searchSourceBuilder.sort(<span class="hljs-keyword">new</span> ScoreSortBuilder().order(SortOrder.DESC));
	<span class="hljs-keyword">else</span> engineBaseMethod.sort(searchSourceBuilder,index);
	
	
	<span class="hljs-comment">/*构建查询*/</span>
	engineBaseMethod.createQuery(searchRequest, searchSourceBuilder, from, size, booleanQueryBuilder);
	SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);
	<span class="hljs-comment">/*解析结果并返回*/</span>
	List&lt;Map&lt;String, Object&gt;&gt; result = <span class="hljs-keyword">new</span> ArrayList&lt;Map&lt;String,Object&gt;&gt;();
	engineBaseMethod.searchResultAnalyse(result, searchResponse);
	<span class="hljs-keyword">return</span> result;
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">searchTips</span><span class="hljs-params">(String keyword, String type)</span> <span class="hljs-keyword">throws</span> IOException, FontFormatException </span>&#123;
	RestHighLevelClient client = ESClient.instance(esConfig);
	
	<span class="hljs-comment">//前缀搜索建议</span>
	SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(esConfig.getIndex()); 
	SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder(); 
	CompletionSuggestionBuilder suggestionBuilder = <span class="hljs-keyword">new</span> CompletionSuggestionBuilder(<span class="hljs-string">"suggest"</span>);
	suggestionBuilder.prefix(keyword);
	suggestionBuilder.size(esConfig.getSize());
	suggestionBuilder.skipDuplicates(<span class="hljs-keyword">true</span>);
	SuggestBuilder suggestBuilder = <span class="hljs-keyword">new</span> SuggestBuilder();
	suggestBuilder.addSuggestion(<span class="hljs-string">"search_tips"</span>, suggestionBuilder);
	searchSourceBuilder.suggest(suggestBuilder);
	searchRequest.source(searchSourceBuilder);
	SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);
	
	<span class="hljs-comment">//匹配搜索建议</span>
	SearchSourceBuilder querySourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder(); 
	SearchRequest queryRequest = <span class="hljs-keyword">new</span> SearchRequest(esConfig.getIndex()); 
	BoolQueryBuilder booleanQueryBuilder = QueryBuilders.boolQuery();
	<span class="hljs-keyword">if</span>(StringUtils.isNotBlank(keyword)) booleanQueryBuilder.should(QueryBuilders.matchQuery(<span class="hljs-string">"title"</span>,keyword));
	String notTypes = StringUtils.join(dict.getMustNot(), <span class="hljs-string">","</span>);
	engineBaseMethod.searchMustNot(booleanQueryBuilder, <span class="hljs-string">"type"</span>,notTypes);
	querySourceBuilder.query(booleanQueryBuilder);
	queryRequest.source(querySourceBuilder);
	SearchResponse queryResponse = client.search(queryRequest, RequestOptions.DEFAULT);
	
	<span class="hljs-comment">/*解析结果并返回*/</span>
	List&lt;String&gt; result = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();
	Suggest suggest = searchResponse.getSuggest();
	CompletionSuggestion completionSuggestion = suggest.getSuggestion(<span class="hljs-string">"search_tips"</span>);
	<span class="hljs-keyword">for</span>(CompletionSuggestion.Entry entry : completionSuggestion.getEntries()) &#123; 
		<span class="hljs-keyword">for</span> (CompletionSuggestion.Entry.Option option : entry) &#123; 
			String optionType = option.getHit().getSourceAsMap().get(<span class="hljs-string">"type"</span>).toString();
			<span class="hljs-keyword">if</span>(StringUtils.equals(type, <span class="hljs-string">"all"</span>) || StringUtils.equals(type,optionType)) result.add(option.getText().string());
		&#125;
	&#125;
	<span class="hljs-keyword">for</span>(SearchHit hit:queryResponse.getHits()) &#123;
		String text = (String) hit.getSourceAsMap().get(<span class="hljs-string">"title"</span>);
		<span class="hljs-keyword">if</span>(!result.contains(text)) result.add(text);
	&#125;
	<span class="hljs-keyword">return</span> result;
&#125;</code></pre>
<h2 id="集群安装"><a href="#集群安装" class="headerlink" title="集群安装"></a>集群安装</h2><p><strong>master 配置</strong></p>
<pre><code class="hljs bash"><span class="hljs-comment"># ---------------------------------- Cluster -----------------------------------</span>
cluster.name: es-cluster

<span class="hljs-comment"># ------------------------------------ Node ------------------------------------</span>
node.name: node1-rec
node.master: <span class="hljs-literal">true</span>
node.data: <span class="hljs-literal">false</span> 

<span class="hljs-comment"># ----------------------------------- Paths ------------------------------------</span>
path.data: /data/es/data
path.logs: /data/es/logs

<span class="hljs-comment"># ----------------------------------- Memory -----------------------------------</span>
bootstrap.memory_lock: <span class="hljs-literal">false</span>

<span class="hljs-comment"># ---------------------------------- Network -----------------------------------</span>
network.host: 0.0.0.0
network.publish_host: 10.2.64.110
http.port: 9200

<span class="hljs-comment"># --------------------------------- Discovery ----------------------------------</span>

discovery.seed_hosts: [<span class="hljs-string">"10.2.64.110"</span>, <span class="hljs-string">"10.2.64.111"</span>, <span class="hljs-string">"10.2.64.112"</span>]

cluster.initial_master_nodes: [<span class="hljs-string">"10.2.64.110"</span>]
discovery.zen.fd.ping_timeout: 1m
discovery.zen.fd.ping_retries: 5
http.cors.allow-origin: <span class="hljs-string">"*"</span> 
http.cors.enabled: <span class="hljs-literal">true</span>
bootstrap.system_call_filter: <span class="hljs-literal">false</span>

xpack.license.self_generated.type: basic</code></pre>
<p><strong>node 配置</strong></p>
<pre><code class="hljs bash">cluster.name: es-cluster
<span class="hljs-comment"># ------------------------------------ Node ------------------------------------</span>
node.name: node2-rec
node.master: <span class="hljs-literal">false</span>
node.data: <span class="hljs-literal">true</span> 
<span class="hljs-comment"># ----------------------------------- Paths ------------------------------------</span>
path.data: /data/es/data
path.logs: /data/es/logs
<span class="hljs-comment"># ----------------------------------- Memory -----------------------------------</span>
bootstrap.memory_lock: <span class="hljs-literal">false</span>
<span class="hljs-comment"># ---------------------------------- Network -----------------------------------</span>
network.host: 0.0.0.0
network.publish_host: 10.2.64.111
http.port: 9200
<span class="hljs-comment"># --------------------------------- Discovery ----------------------------------</span>
discovery.seed_hosts: [<span class="hljs-string">"10.2.64.110"</span>, <span class="hljs-string">"10.2.64.111"</span>, <span class="hljs-string">"10.2.64.112"</span>]

cluster.initial_master_nodes: [<span class="hljs-string">"10.2.64.110"</span>]
discovery.zen.fd.ping_timeout: 1m
discovery.zen.fd.ping_retries: 5
http.cors.allow-origin: <span class="hljs-string">"*"</span> 
http.cors.enabled: <span class="hljs-literal">true</span>
bootstrap.system_call_filter: <span class="hljs-literal">false</span>
<span class="hljs-comment">#</span>
xpack.license.self_generated.type: basic</code></pre>
<p><strong>master kibana 配置</strong></p>
<pre><code class="hljs bash">server.port: 5601
server.host: <span class="hljs-string">"0.0.0.0"</span>
server.name: <span class="hljs-string">"node1-rec"</span>
elasticsearch.hosts: [<span class="hljs-string">"http://10.2.64.110:9200"</span>,<span class="hljs-string">"http://10.2.64.111:9200"</span>,<span class="hljs-string">"http://10.2.64.112:9200"</span>]</code></pre>
<p><strong>Kibana查看集群状态</strong></p>
<pre><code class="hljs routeros"><span class="hljs-builtin-name">GET</span> _cluster/health?pretty

&#123;
  <span class="hljs-string">"cluster_name"</span> : <span class="hljs-string">"es-cluster"</span>,
  <span class="hljs-string">"status"</span> : <span class="hljs-string">"green"</span>,
  <span class="hljs-string">"timed_out"</span> : <span class="hljs-literal">false</span>,
  <span class="hljs-string">"number_of_nodes"</span> : 3,
  <span class="hljs-string">"number_of_data_nodes"</span> : 2,
  <span class="hljs-string">"active_primary_shards"</span> : 7,
  <span class="hljs-string">"active_shards"</span> : 14,
  <span class="hljs-string">"relocating_shards"</span> : 0,
  <span class="hljs-string">"initializing_shards"</span> : 0,
  <span class="hljs-string">"unassigned_shards"</span> : 0,
  <span class="hljs-string">"delayed_unassigned_shards"</span> : 0,
  <span class="hljs-string">"number_of_pending_tasks"</span> : 0,
  <span class="hljs-string">"number_of_in_flight_fetch"</span> : 0,
  <span class="hljs-string">"task_max_waiting_in_queue_millis"</span> : 0,
  <span class="hljs-string">"active_shards_percent_as_number"</span> : 100.0
&#125;</code></pre>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/elasticsearch/">elasticsearch</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/03/31/convolution/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">卷积操作汇总</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2019/11/01/android%E4%BD%BF%E7%94%A8opencv%20native%E6%96%B9%E5%BC%8F%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">
                        <span class="hidden-mobile">android使用opencv native方式环境搭建</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <script type="text/javascript">
    function loadUtterances() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'JiaoPaner/blog-talk.git');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    }
    waitElementVisible('comments', loadUtterances)
  </script>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>







  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "elasticsearch 教程&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.staticfile.org/mathjax/3.0.5/es5/tex-svg.js" ></script>

  
















</body>
</html>
